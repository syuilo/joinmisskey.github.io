<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1"><title>AWS版Misskeyインストール方法詳説</title><!--*
*
* GitHub: https://github.com/joinmisskey
*
*--><link rel="canonical" href="https://join.misskey.page/en/wiki/developers/installation/aws"><link rel="alternate" hreflang="ja" href="https://join.misskey.page/ja/wiki/developers/installation/aws"><link rel="alternate" hreflang="en" href="https://join.misskey.page/en/wiki/developers/installation/aws"><link rel="alternate" hreflang="fr" href="https://join.misskey.page/fr/wiki/developers/installation/aws"><meta name="author" content="Misskey"><meta name="generator" content="maqz"><meta name="description" content="Amazon Web Service (AWS)でMisskeyを動作させる方法の一例を紹介。"><link rel="manifest" href="/manifest.json"><link rel="alternate" type="application/atom+xml" title="joinmisskey" href="https://join.misskey.page/feed.atom"><link rel="alternate" type="application/rss+xml" title="joinmisskey" href="https://join.misskey.page/feed.rss"><link rel="alternate" type="application/json" title="joinmisskey" href="https://join.misskey.page/feed.json"><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/mplus-c/mplus-c-light.latain.woff2" as="font" crossorigin><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/mplus-p/mplus-p-regular.latain.woff2" as="font" crossorigin><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/mplus-p/mplus-p-bold.latain.woff2" as="font" crossorigin><link rel="preload" href="/assets/styles/fonts.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.0/animate.min.css" as="style"><link rel="preload" href="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" as="script"><script id="page_variables">var pathname = "/";
var currentLocale = "en";
var locales = ["ja","en","fr"];
var permalink = "/wiki/developers/installation/aws";
var gaId = "UA-121612835-1";
var jm_pathToWorker = "https://join.misskey.page/service_worker.js"
</script><script src="/assets/scripts/sw.js" async></script><script src="/assets/scripts/bootstrap.js" async></script><script src="/assets/scripts/main.js" async></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-121612835-1" async></script><link rel="stylesheet" href="/assets/styles/main.css"><script data-ad-client="ca-pub-1736621122676736" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-1736621122676736",
  enable_page_level_ads: true,
  overlays: { bottom: true }
});
</script><link rel="icon" href="/favicon.ico" type="image/vnd.microsoft.icon"><link rel="apple-touch-icon" href="/files/images/icons/icon.svg?v=undefined" sizes="192x192"><link rel="icon" href="/files/images/icons/icon.svg?v=undefined" sizes="192x192" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/icons/icon.png?v=undefined" sizes="700x700"><link rel="icon" href="/files/images/icons/icon.png?v=undefined" sizes="700x700" type="image/png"><link rel="apple-touch-icon" href="/files/images/imports/2019/12/icon.svg?v=undefined" sizes="192x192"><link rel="icon" href="/files/images/imports/2019/12/icon.svg?v=undefined" sizes="192x192" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/imports/2019/12/icon.360.png?v=undefined" sizes="360x360"><link rel="icon" href="/files/images/imports/2019/12/icon.360.png?v=undefined" sizes="360x360" type="image/png"><link rel="apple-touch-icon" href="/files/images/imports/2019/12/icon.720.png?v=undefined" sizes="720x720"><link rel="icon" href="/files/images/imports/2019/12/icon.720.png?v=undefined" sizes="720x720" type="image/png"><link rel="apple-touch-icon" href="/files/images/imports/2019/12/icon.png?v=undefined" sizes="1200x1200"><link rel="icon" href="/files/images/imports/2019/12/icon.png?v=undefined" sizes="1200x1200" type="image/png"><meta name="theme-color" content="#105779"><meta property="og:type" content="website"><meta property="og:title" content="AWS版Misskeyインストール方法詳説"><meta property="og:description" content="Amazon Web Service (AWS)でMisskeyを動作させる方法の一例を紹介。"><meta property="og:image" content="https://join.misskey.page/files/images/imports/2019/10/thumb.png?v=undefined"><meta property="og:url" content="https://join.misskey.page/en/wiki/developers/installation/aws"><meta property="og:site_name" content="Let's start Misskey"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://join.misskey.page/files/images/imports/2019/10/thumb.png?v=undefined"><meta name="twitter:title" content="AWS版Misskeyインストール方法詳説"><meta name="twitter:description" content="Amazon Web Service (AWS)でMisskeyを動作させる方法の一例を紹介。"><meta name="twitter:site" content="misskey_io"></head><body><div id="nav"><nav class="navbar navbar-expand-md navbar-light flex-row p-0" id="mainnav"><button class="navbar-toggler" data-toggle="collapse" data-target="#navtoggle" aria-controls="navtoggle" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fas bars" data-fa-prefix="fas" data-fa-icon-name="bars" data-fa-option="{}"></i></button><div class="collapse navbar-collapse" id="navtoggle"><ul class="navbar-nav mr-auto mt-lg-0 ml-3 ml-md-0"><li class="nav-item px-md-3"><a class="nav-link" href="/en/"><i class="fa fas home" data-fa-prefix="fas" data-fa-icon-name="home" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;Home</span></a></li><li class="nav-item px-md-3"><a class="nav-link" href="/en/blog/"><i class="fa fas broadcast-tower" data-fa-prefix="fas" data-fa-icon-name="broadcast-tower" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;Blog</span></a></li><li class="nav-item px-md-3 active"><a class="nav-link" href="/en/wiki/"><i class="fa fas book" data-fa-prefix="fas" data-fa-icon-name="book" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;Wiki</span></a></li></ul><div class="input-group flex-nowrap" id="search"><input class="form-control" id="searchInput" type="search" placeholder="検索語句を入力" aria-label="Search"><div class="input-group-append flex-grow-0 flex-shrink-0"><button class="btn btn-primary" id="searchButton"><i class="fa fas search" data-fa-prefix="fas" data-fa-icon-name="search" data-fa-option="{'classes':['fa-fw']}"></i> Search</button></div></div></div><div class="dropleft"><button class="btn btn-outline-primary dropdown-toggle" type="button" id="locale_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">A文</button><div class="dropdown-menu m-2" aria-labelledby="locale_dropdown"><button class="nihongo dropdown-item" data-lang="ja">日本語</button><button class="nihongo dropdown-item" data-lang="en">English</button><button class="nihongo dropdown-item" data-lang="fr">Français</button></div></div></nav><nav class="bg-transparent" aria-label="breadcrumb" id="breadcrumb"><div class="container-fulid px-1 px-lg-5"><ol class="breadcrumb bg-transparent text-primary my-0 mx-md-5 mx-1 py-1 px-0"><li class="breadcrumb-item"><a class="py-1 text-primary" href="/en/"><i class="fa fas home" data-fa-prefix="fas" data-fa-icon-name="home" data-fa-option="{'classes':['fa-fw']}"></i><span class="sr-only">Home</span></a></li><li class="breadcrumb-item"><a class="py-1 text-primary" href="/en/wiki/">Wiki</a></li><li class="breadcrumb-item"><a class="py-1 text-primary" href="/en/wiki/developers/">開発者・運営者向け情報</a></li><li class="breadcrumb-item"><a class="py-1 text-primary" href="/en/wiki/developers/installation/">Misskeyインストール方法詳説</a></li><li class="breadcrumb-item active"><a class="text-dark font-weight-bold trigger-gototop button-like-anchor" aria-current="page" href="https://join.misskey.page/en/wiki/developers/installation/aws">AWS</a></li></ol></div></nav></div><div class="padding row" id="main"><div class="sade-outer d-none d-xl-block col-xl-3 order-1"><ins class="adsbygoogle p-0 sade d-none d-xl-block" style="display:block;" data-ad-client="ca-pub-1736621122676736" data-ad-slot="2773092095" data-ad-format="vertical" data-full-width-responsive="false"></ins></div><div class="p-0 col-12 px-xl-3 col-xl-9 order-0"><div class="container pt-5 pb-3 mb-2 bg-white main-shadow"><article class="bg-white" id="article_maincontent"><header class="w-100"><h1>AWS版Misskeyインストール方法詳説</h1></header><div class="my-2 p-3 bg-light" id="article_sidenav"><details><summary class="font-weight-bold">目次</summary><ul class="list-unstyled ml-3 page-index m-0 p-0"><li><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</a></li><li><a href="#%E7%92%B0%E5%A2%83%E3%81%A8%E6%9D%A1%E4%BB%B6">環境と条件</a></li><li><a href="#nano%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9">nanoの使い方</a></li><li><a href="#AWS%E3%81%AB%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97">AWSにサインアップ</a></li><li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90">セキュリティグループの作成</a></li><li><a href="#VPC%E3%82%92IPv6%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%95%E3%81%9B%E3%82%8B">VPCをIPv6に対応させる</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#IPv6%20CIDR%20%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%82%92%20VPC%20%E3%81%8A%E3%82%88%E3%81%B3%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%81%A8%E9%96%A2%E9%80%A3%E4%BB%98%E3%81%91%E3%82%8B">IPv6 CIDR ブロックを VPC およびサブネットと関連付ける</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#VPC">VPC</a></li><li><a href="#%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88">サブネット</a></li></ul><li><a href="#Egress%20Only%20%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E3%82%B2%E3%83%BC%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A4%E3%81%AE%E4%BD%9C%E6%88%90">Egress Only インターネットゲートウェイの作成</a></li><li><a href="#%E3%83%AB%E3%83%BC%E3%83%88%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%92%E6%9B%B4%E6%96%B0">ルートテーブルを更新</a></li></ul><li><a href="#RDS%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90">RDSインスタンスの作成</a></li><li><a href="#ElastiCache%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90">ElastiCacheインスタンスの作成</a></li><ul class="list-unstyled ml-3 page-index"><ul class="list-unstyled ml-3 page-index"><li><a href="#%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97">サブネットグループ</a></li></ul></ul><li><a href="#S3%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E6%BA%96%E5%82%99">S3バケットの準備</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#IAM%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90">IAMユーザーの作成</a></li><li><a href="#%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90">バケットの作成</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E5%90%8D%E5%89%8D%E3%81%A8%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3">名前とリージョン</a></li><li><a href="#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A">オプションの設定</a></li><li><a href="#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A8%B1%E5%8F%AF%E3%81%AE%E8%A8%AD%E5%AE%9A">アクセス許可の設定</a></li><li><a href="#%E7%A2%BA%E8%AA%8D">確認</a></li></ul><li><a href="#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90">アクセスポイントの作成</a></li></ul><li><a href="#CloudFront%E3%83%87%E3%82%A3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90">CloudFrontディストリビューションの作成</a></li><li><a href="#EC2%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E6%BA%96%E5%82%99">EC2インスタンスの準備</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#IPv6%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%95%E3%81%9B%E3%82%8B">IPv6に対応させる</a></li><li><a href="#%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B5%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90">ロードバランサーの作成</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#1%3A%20%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B5%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A">1: ロードバランサーの設定</a></li><li><a href="#2%3A%20%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A%E3%81%AE%E6%A7%8B%E6%88%90">2: セキュリティ設定の構成</a></li><li><a href="#3%3A%20%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E8%A8%AD%E5%AE%9A">3: セキュリティグループの設定</a></li><li><a href="#4%3A%20%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%AD%E5%AE%9A">4: ルーティングの設定</a></li><li><a href="#5%3A%20%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88%E3%81%AE%E7%99%BB%E9%8C%B2">5: ターゲットの登録</a></li><li><a href="#6%3A%20%E7%A2%BA%E8%AA%8D">6: 確認</a></li><li><a href="#DNS%E3%82%92%E8%A8%AD%E5%AE%9A">DNSを設定</a></li></ul><li><a href="#SSH%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B">SSHで接続する</a></li><li><a href="#Node.js">Node.js</a></li><li><a href="#Git%E3%81%9D%E3%81%AE%E4%BB%96">Gitその他</a></li></ul><li><a href="#Misskey%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Misskeyのインストール</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E5%BF%85%E8%A6%81%E3%81%AA">必要な</a></li><li><a href="#default.yml%E3%82%92%E4%BD%9C%E6%88%90">default.ymlを作成</a></li><li><a href="#Misskey%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89">Misskeyのビルド</a></li></ul><li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96">データベースの初期化</a></li><li><a href="#Misskey%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B">Misskeyを起動する</a></li><li><a href="#S3%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">S3を設定する</a></li><li><a href="#Misskey%E3%81%AE%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90">Misskeyのデーモンを作成</a></li><li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E7%A8%AE%E3%80%85%E3%81%AE%E8%A8%AD%E5%AE%9A">インスタンスの種々の設定</a></li></ul></details></div><section class="pt-2 pb-4"><h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB" class="blogstyle">はじめに</h2><p>この記事では、<a href="https://github.com/syuilo/misskey/blob/master/docs/setup.ja.md" target="_blank" rel="noopener">リポジトリに同梱されている『Misskey構築の手引き』 (setup.md)<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を基に、AWSでMisskeyをインストールし公開する方法の一挙手一投足を解説する。</p><p>大まかな流れは上の<strong>目次</strong>をクリックし展開することで確認できる。</p><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><p>この記事では、具体性を重視し、特定の環境に特化した記述をしている。<br>OSの違い、Misskey本体や依存するソフトウェアのバージョンアップで変わってしまった部分等あるかもしれないが、ご容赦願いたい。</p><p>わからない単語については、<a href="https://wa3.i-3-i.info/" target="_blank" rel="noopener">『「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典』<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>で調べて分かった気になってほしい。</p><p>なお、今回の記事にあたっては、AWSの無料利用枠でできる範囲で検証を行った。</p><h2 id="%E7%92%B0%E5%A2%83%E3%81%A8%E6%9D%A1%E4%BB%B6" class="blogstyle">環境と条件</h2><ul><li>EC2、RDB、ElastiCache、S3およびCloudFrontを利用する。</li><li>独自のドメインを購入する。<ul><li>ドメインは<a href="https://domains.google/intl/ja_jp/" target="_blank" rel="noopener">Google Domains<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>などで予め用意しておくこと。</li><li>ここではドメインを<code class="language-javascript">example<span class="token punctuation">.</span>tld</code>として解説を進めるので、自分が買ったドメインに適宜置き換えて読むこと。</li></ul></li><li>ElasticSearchは使用しない。</li></ul><h2 id="nano%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9" class="blogstyle">nanoの使い方</h2><p>今回はテキストエディターにnanoを使う。次のように起動する。</p><pre class="language-javascript"><code class="language-bash">nano <span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>file</code></pre><p>一般的な矢印ボタンや<kbd>Home</kbd>/<kbd>End</kbd>などを利用してカーソルを移動できる。</p><p>終了は<kbd>Ctrl+X</kbd>で、変更を保存するか聞かれた場合<kbd>Y</kbd>(Yes)を入力し<kbd>Enter</kbd>すると保存できる。</p><p>下部にコマンド一覧が表示されるので、<code class="language-javascript"><span class="token operator">^</span></code>を<kbd>Ctrl</kbd>、<code class="language-javascript"><span class="token constant">M</span><span class="token operator">-</span></code>を<kbd>Alt</kbd>と読み替えて参考にしよう。</p><h2 id="AWS%E3%81%AB%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97" class="blogstyle">AWSにサインアップ</h2><p>まずは<a href="https://aws.amazon.com/jp/" target="_blank" rel="noopener">AWSのサイト<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>にアクセスし、サインアップしよう。</p><p>サインアップが完了したら、<a href="https://ap-northeast-1.console.aws.amazon.com/console/" target="_blank" rel="noopener"><strong>ここを開いてサインインする</strong><i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>。</p><h2 id="%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">セキュリティグループの作成</h2><p>ローカルネットワークのみでアクセスできるようなセキュリティグループを作成する。</p><ol><li><a href="https://console.aws.amazon.com/ec2/home#SecurityGroups" target="_blank" rel="noopener">セキュリティグループの設定を開く<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a></li><li>[セキュリティグループの作成]を選択</li><li>以下のように記入<ul><li>[セキュリティグループ名]、[説明]ともに<code class="language-javascript">local</code></li><li>[ルールの追加]を選択し、<ul><li>[タイプ]を<code class="language-javascript">全てのトラフィック</code>に</li><li>[CIDR、IP]に<code class="language-javascript"><span class="token number">172.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">6</span></code></li></ul></li></ul></li></ol><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="VPC%E3%82%92IPv6%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%95%E3%81%9B%E3%82%8B" class="blogstyle">VPCをIPv6に対応させる</h2><p>AWSは標準ではIPv6に対応しないので、IPv6を設定する。</p><h3 id="IPv6%20CIDR%20%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%82%92%20VPC%20%E3%81%8A%E3%82%88%E3%81%B3%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%81%A8%E9%96%A2%E9%80%A3%E4%BB%98%E3%81%91%E3%82%8B" class="blogstyle">IPv6 CIDR ブロックを VPC およびサブネットと関連付ける</h3><h4 id="VPC" class="blogstyle">VPC</h4><ol><li><a href="https://console.aws.amazon.com/vpc/home#vpcs" target="_blank" rel="noopener">VPC一覧<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を開く。</li><li>VPCを選択し、[アクション] - [CIDR の編集]と選択。</li><li>[IPv6 CIDR の追加]を選択。IPv6 CIDRブロックが追加されたら[閉じる]を選択。</li></ol><p><strong>ここでVPCのID（vpc-...）をメモしておくこと。</strong></p><h4 id="%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88" class="blogstyle">サブネット</h4><ol><li>画面左側のナビゲーションペインで[サブネット]を選択。</li><li>サブネットを選択し、[アクション] - [IPv6 CIDR の編集]と選択。</li><li>[IPv6 CIDR の追加]を選択。16進法2文字でサブネットのCIDRブロックを割り当て（記入例: 00, 01)。</li><li>[保存]を選択。VPC内の他のサブネットにも同様に繰り返す。</li></ol><h3 id="Egress%20Only%20%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E3%82%B2%E3%83%BC%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A4%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">Egress Only インターネットゲートウェイの作成</h3><ol><li>ナビゲーションペインで[Egress Only インターネットゲートウェイ]を選択。</li><li>[Egress Only インターネットゲートウェイの作成]を選択。</li><li>VPCを選択し[作成]を選択、さらに[閉じる]を選択。</li></ol><h3 id="%E3%83%AB%E3%83%BC%E3%83%88%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%92%E6%9B%B4%E6%96%B0" class="blogstyle">ルートテーブルを更新</h3><ul><li>ナビゲーションペインで[ルートテーブル]を選択し、ルートテーブルを選択。</li><li>[ルート]タブで[ルートの編集]を選択。</li><li>[ルートの追加]を選択。<ul><li>[送信先]に<code class="language-javascript"><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token number">0</span></code>を指定</li><li>[ターゲット]を選択し、[Egress Only Internet Gateway] - <code class="language-javascript">eigw<span class="token operator">-</span>（英数字）</code>と選択。</li></ul></li><li>[ルートの保存]を選択、さらに[閉じる]を選択。</li></ul><p><small><a href="https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-migrate-ipv6.html#vpc-migrate-ipv6-cidr" target="_blank" rel="noopener">https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-migrate-ipv6.html#vpc-migrate-ipv6-cidr</a></small></p><h2 id="RDS%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">RDSインスタンスの作成</h2><p><a href="https://console.aws.amazon.com/rds/" target="_blank" rel="noopener">RDSコンソール（https://console.aws.amazon.com/rds/）<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を開き、RDSインスタンスを作成しよう。<br>以下の設定で進める。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">DB 識別子</td><td align="left">pg</td></tr><tr><td align="left">エンジン</td><td align="left">PostgreSQL 11.5以上 *2</td></tr><tr><td align="left">マスターユーザー名</td><td align="left">postgres</td></tr><tr><td align="left">マスターパスワード</td><td align="left">password *3</td></tr><tr><td align="left">最初のデータベース名（追加設定）</td><td align="left">mk1</td></tr></tbody></table><p>*1: Aurora PostgreSQLでの動作は確認していないが、11.4以上であれば恐らく動くと思われる<br>*2: 無料利用枠で利用したい場合、エンジンをPostgreSQLにすると無料利用枠を選択できる<br>*3: 当然ながら自分で考えて設定すること</p><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><p>ここでできたデータベースのエンドポイントは、ここでは<code class="language-javascript">pg<span class="token punctuation">.</span>xxxxxxxx<span class="token punctuation">.</span>ap<span class="token operator">-</span>northeast<span class="token operator">-</span><span class="token number">1.</span>rds<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com</code>として説明する。</p><h2 id="ElastiCache%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">ElastiCacheインスタンスの作成</h2><p><a href="https://ap-northeast-1.console.aws.amazon.com/elasticache/" target="_blank" rel="noopener">ElastiCacheコンソール（https://ap-northeast-1.console.aws.amazon.com/elasticache/）<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を開き、ElastiCacheインスタンスを作成しよう。</p><p>以下のように値を設定する。ここで明示ていない値の変更は自己責任で。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">クラスターエンジン</td><td align="left">Redis<br>クラスターモード無効</td></tr><tr><td align="left">名前</td><td align="left">redis</td></tr><tr><td align="left">ポート</td><td align="left">6379</td></tr><tr><td align="left">ノードのタイプ</td><td align="left">cache.t2.micro</td></tr><tr><td align="left">レプリケーション数</td><td align="left">0</td></tr></tbody></table><h4 id="%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97" class="blogstyle">サブネットグループ</h4><p>（新規作成）</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">名前</td><td align="left">subnet</td></tr><tr><td align="left">サブネット</td><td align="left">（全てのサブネットにチェックを入れる）</td></tr></tbody></table><p>[作成]を選択。</p><p>▶を選択し、プライマリエンドポイントを確認。ここでは<code class="language-javascript">redis<span class="token punctuation">.</span>xxxxxx<span class="token punctuation">.</span><span class="token number">0001.</span>apne0<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com<span class="token punctuation">:</span><span class="token number">6379</span></code>であったものとして説明する。</p><h2 id="S3%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E6%BA%96%E5%82%99" class="blogstyle">S3バケットの準備</h2><h3 id="IAM%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">IAMユーザーの作成</h3><p><a href="https://console.aws.amazon.com/iam/home#/users$new" target="_blank" rel="noopener">IAM/ユーザーを追加<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を開く。<br>以下のように設定する。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">ユーザー名</td><td align="left">mks3</td></tr><tr><td align="left">アクセスの種類</td><td align="left">プログラムによるアクセスにチェック</td></tr></tbody></table><p>[次のステップ]を選択。</p><p>[既存のポリシーを直接アタッチ]を選択し、<code class="language-javascript">AmazonS3FullAccess</code>にチェック。<br>[次のステップ]へ。さらに[次のステップ]を選択。そして[ユーザーの作成]を選択。</p><p><strong>アクセスキー ID</strong>、および<strong>シークレットアクセスキー</strong>を表示し、メモしておく。</p><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h3 id="%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">バケットの作成</h3><p><a href="https://s3.console.aws.amazon.com/s3/home" target="_blank" rel="noopener">S3コンソール<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を開き、[+バケットを作成する]を選択。</p><h4 id="%E5%90%8D%E5%89%8D%E3%81%A8%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3" class="blogstyle">名前とリージョン</h4><p>以下のように設定する。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">バケット名</td><td align="left">example.tld</td></tr><tr><td align="left">リージョン</td><td align="left">アジアパシフィック（東京）</td></tr></tbody></table><p>[次へ]を選択。</p><h4 id="%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">オプションの設定</h4><p>何もすることはないので[次へ]を選択。</p><h4 id="%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A8%B1%E5%8F%AF%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">アクセス許可の設定</h4><p>何もすることはないので[次へ]を選択。</p><h4 id="%E7%A2%BA%E8%AA%8D" class="blogstyle">確認</h4><p>[バケットを作成]を選択。</p><h3 id="%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">アクセスポイントの作成</h3><p>example.tld を選択。[アクセスポイント]タブを開き、[+アクセスポイントを作成]を選択。<br>以下のように設定する。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">アクセスポイント名</td><td align="left">s3ap</td></tr><tr><td align="left">リージョン</td><td align="left">アジアパシフィック（東京）</td></tr><tr><td align="left">VPC ID</td><td align="left">メモしておいたVPC IDを貼り付け</td></tr></tbody></table><p>[アクセスポイントを作成]を選択。</p><h2 id="CloudFront%E3%83%87%E3%82%A3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">CloudFrontディストリビューションの作成</h2><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><ol><li><a href="https://console.aws.amazon.com/cloudfront/home?region=ap-northeast-1#create-distribution" target="_blank" rel="noopener">CloudFrontディストリビューションの作成ウィザードを開始<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>する。</li><li>Webの[Get Started]を選択</li><li>次のように設定する</li></ol><p>|Origin Domain Name|example.tld.s3.amazonaws.com| |Restrict Bucket Access|Yes| |Origin Access Identity|Create a New Identity| |Grant Read Permissions on Bucket|Yes, Update Bucket Policy| |Viewer Protocol Policy|Redirect HTTP to HTTPS| |Object Caching|Customize| |Price Class|Use U.S., Canada, Europe, Asia, Middle East and Africa|</p><p>ナビゲーションペインでDistributionsを選択し、作成されたディストリビューションの<strong>Domain name</strong>をメモしておく。ここでは<code class="language-javascript">xxxxxxxxxx<span class="token punctuation">.</span>cloudfront<span class="token punctuation">.</span>net</code>であるとする。</p><h2 id="EC2%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E6%BA%96%E5%82%99" class="blogstyle">EC2インスタンスの準備</h2><p>EC2インスタンスを作成しよう。</p><ol><li><a href="https://console.aws.amazon.com/ec2/v2/home#LaunchInstanceWizard" target="_blank" rel="noopener">インスタンスウィザードを開始<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>する。</li><li>右上の青い[選択]ボタンを選択。</li><li>無料枠ならデフォルトのt2.microを選択し、[確認と作成]を選択。</li><li>[起動]を選択。</li><li>[既存のキーペアの選択]のところを[新しいキーペアの選択]に変更し、キーペア名を入力。ここでは<code class="language-javascript">key</code>とする。</li><li>[キーペアのダウンロード]を選択。<code class="language-javascript">key<span class="token punctuation">.</span>pem</code>がダウンロードされるので確認する。</li><li>[インスタンスの作成]を選択。</li><li><code class="language-javascript">key<span class="token punctuation">.</span>pem</code>を<code class="language-javascript"><span class="token operator">%</span><span class="token constant">USERPROFILE</span><span class="token operator">%</span>\<span class="token punctuation">.</span>ssh</code>内に移動。</li><li>ブラウザに戻り、次のインスタンスの作成が開始されました: に続くリンクを選択。</li></ol><h3 id="IPv6%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%95%E3%81%9B%E3%82%8B" class="blogstyle">IPv6に対応させる</h3><ol><li>[アクション]を選択し、[ネットワーキング]-[IP アドレスの管理]を選択。</li><li>ダイアログが出てきたら、<strong>IPv6 アドレス</strong>の[新しい IP の割り当て]を選択し、[更新する]を選択</li><li>[更新する]を選択し、さらに[キャンセル]を選択。</li></ol><h3 id="%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B5%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">ロードバランサーの作成</h3><p><a href="https://console.aws.amazon.com/ec2/v2/home#V2CreateELBWizard" target="_blank" rel="noopener">ロードバランサーの作成ウィザード<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を開く。</p><h4 id="1%3A%20%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B5%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">1: ロードバランサーの設定</h4><p>以下のように設定する。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">名前</td><td align="left">misskey</td></tr><tr><td align="left">IPアドレスタイプ</td><td align="left">dualstack</td></tr><tr><td align="left">ロードバランサーのプロトコル</td><td align="left">HTTP, HTTPS</td></tr><tr><td align="left">VPC</td><td align="left">（プルダウンから選択）</td></tr><tr><td align="left">アベイラビリティーゾーン</td><td align="left">全てチェックをつける</td></tr></tbody></table><p>[次の手順]を選択</p><h4 id="2%3A%20%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E8%A8%AD%E5%AE%9A%E3%81%AE%E6%A7%8B%E6%88%90" class="blogstyle">2: セキュリティ設定の構成</h4><ol><li>[ACM　から新しい証明書をリクエスト]を選択</li><li>新しいタブが開くので、<code class="language-javascript">example<span class="token punctuation">.</span>tld</code>（ドメイン）を入力、また[この証明書に別の名前を追加]を選択し<code class="language-javascript"><span class="token operator">*</span><span class="token punctuation">.</span>example<span class="token punctuation">.</span>tld</code>を入力</li><li><strong>DNS の検証</strong>を選択し[次へ]を選択</li><li>[確認]を選択</li><li>[確定とリクエスト]を選択</li><li><strong>▶ example.tld</strong>を選択し、お使いのDNSにて表示された設定を追加する</li><li>[続行]を選択</li><li>5分程度待つ</li><li>状況が<code class="language-javascript">発行済み</code>になったら、タブを閉じる</li><li>証明書の名前に先ほど発行した証明書が設定されているのを確認し、[次の手順]を選択</li></ol><h4 id="3%3A%20%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">3: セキュリティグループの設定</h4><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><p><strong>新しい</strong>セキュリティグループを作成するを選択。</p><ul><li>セキュリティグループ名は<code class="language-javascript"><span class="token keyword">public</span></code>とする</li><li>タイプを変更する<ul><li>1つ目はHTTP</li><li>2つ目はHTTPS</li></ul></li></ul><p>[次の手順]を選択。</p><h4 id="4%3A%20%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">4: ルーティングの設定</h4><p>名前を<code class="language-javascript">misskey</code>にし、[次の手順]を選択。</p><h4 id="5%3A%20%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88%E3%81%AE%E7%99%BB%E9%8C%B2" class="blogstyle">5: ターゲットの登録</h4><p>ポートを<code class="language-javascript"><span class="token number">3000</span></code>とし、<strong>インスタンス</strong>から作成したインスタンスを選択し[登録済みに追加]を選択。<br>[次の手順]を選択。</p><h4 id="6%3A%20%E7%A2%BA%E8%AA%8D" class="blogstyle">6: 確認</h4><p>[作成]を選択。成功したら[閉じる]を選択。</p><h4 id="DNS%E3%82%92%E8%A8%AD%E5%AE%9A" class="blogstyle">DNSを設定</h4><p>お使いのDNSで、<code class="language-javascript">example<span class="token punctuation">.</span>tld</code>に<strong>CNAME</strong>として作成したロードバランサーの<strong>DNS 名</strong>を指定する。</p><h3 id="SSH%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B" class="blogstyle">SSHで接続する</h3><p>ナビゲーションペインで[インスタンス]を選択し、作成したインスタンスの状態がrunningかつステータスチェックが「チェックに合格しました」となっていることを確認。なっていなければ待つ。</p><p>インスタンスのパブリック DNS （IPv4）をメモしよう。ここでは<code class="language-javascript">ec2<span class="token operator">-</span><span class="token number">13</span><span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token punctuation">.</span>ap<span class="token operator">-</span>northeast<span class="token operator">-</span><span class="token number">1.</span>compute<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com</code>とする。</p><p>sshでEC2インスタンスに接続する。</p><pre class="language-javascript"><code class="language-bash">ssh ec2<span class="token operator">-</span>user@ec2<span class="token operator">-</span><span class="token number">13</span><span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token punctuation">.</span>ap<span class="token operator">-</span>northeast<span class="token operator">-</span><span class="token number">1.</span>compute<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com <span class="token operator">-</span>i <span class="token operator">%</span><span class="token constant">USERPROFILE</span><span class="token operator">%</span>\<span class="token punctuation">.</span>ssh\key<span class="token punctuation">.</span>pem</code></pre><p>Misskeyはrootで実行しない方がよいため、専用のユーザーを作成する。</p><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><pre class="language-javascript"><code class="language-bash">sudo adduser misskey</code></pre><h3 id="Node.js" class="blogstyle">Node.js</h3><p>Node.jsは、サーバーサイドJavaScript環境であり、Misskeyの基本的な実行環境である。</p><pre class="language-javascript"><code class="language-bash">curl <span class="token operator">-</span>sL https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>rpm<span class="token punctuation">.</span>nodesource<span class="token punctuation">.</span>com<span class="token operator">/</span>setup_13<span class="token punctuation">.</span>x <span class="token operator">|</span> sudo bash <span class="token operator">-</span>
sudo yum update
sudo yum install <span class="token operator">-</span>y nodejs</code></pre><p>Node.jsがインストールされたので、バージョンを確認する。</p><pre class="language-javascript"><code class="language-bash">node <span class="token operator">-</span>v</code></pre><p><code class="language-javascript">v13<span class="token punctuation">.</span><span class="token number">3.0</span></code>などと表示されればOK。</p><h3 id="Git%E3%81%9D%E3%81%AE%E4%BB%96" class="blogstyle">Gitその他</h3><p>Git（バージョン管理ソフト）などをインストールする。</p><pre class="language-javascript"><code class="language-bash">sudo yum install <span class="token operator">-</span>y git
sudo yum groupinstall <span class="token string">"Development Tools"</span></code></pre><h2 id="Misskey%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" class="blogstyle">Misskeyのインストール</h2><p>引き続きMisskeyのインストールを行う。</p><p><code class="language-javascript">misskey</code>ユーザーに変更。</p><pre class="language-javascript"><code class="language-bash">sudo su <span class="token operator">-</span> misskey</code></pre><p>Gitでファイル類を展開。</p><pre class="language-javascript"><code class="language-bash">git clone <span class="token operator">-</span>b master git<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>syuilo<span class="token operator">/</span>misskey<span class="token punctuation">.</span>git
cd misskey
git checkout master</code></pre><h3 id="%E5%BF%85%E8%A6%81%E3%81%AA" class="blogstyle">必要な</h3><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><p>必要なnpmパッケージをインストール。</p><pre class="language-javascript"><code class="language-bash">npx yarn install</code></pre><h3 id="default.yml%E3%82%92%E4%BD%9C%E6%88%90" class="blogstyle">default.ymlを作成</h3><p>設定ファイル<code class="language-javascript"><span class="token punctuation">.</span>config<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>yml</code>を作成。</p><pre class="language-javascript"><code class="language-bash">nano <span class="token punctuation">.</span>config<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>yml</code></pre><p>次の内容を貼り付け、適宜置き換える。設定値の変更が必要な箇所は<code class="language-javascript">●</code>で、これまでの流れの中で設定した値を用いる箇所は<code class="language-javascript">〇</code>で示した。<br>この設定ファイルはYAML形式で書かれており、行頭のスペースの数などを間違えるとMisskeyが動かないので、特に注意すること。</p><p>設定できる値と記述方法は<a href="https://github.com/syuilo/misskey/blob/develop/.config/example.yml" target="_blank" rel="noopener"><code class="language-javascript"><span class="token punctuation">.</span>config<span class="token operator">/</span>example<span class="token punctuation">.</span>yml</code><i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>に書かれている。</p><pre class="language-javascript"><code class="language-yaml"># ● Misskeyを公開する<span class="token constant">URL</span>
url<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/example.tld/</span>

# 　 ポートを<span class="token number">3000</span>とする。
port<span class="token punctuation">:</span> <span class="token number">3000</span>

# ● <span class="token constant">RDS</span>の設定。
db<span class="token punctuation">:</span>
  # ●<span class="token punctuation">:</span> <span class="token constant">RDS</span>のエンドポイント
  host<span class="token punctuation">:</span> pg<span class="token punctuation">.</span>xxxxxxxx<span class="token punctuation">.</span>ap<span class="token operator">-</span>northeast<span class="token operator">-</span><span class="token number">1.</span>rds<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com
  port<span class="token punctuation">:</span> <span class="token number">5432</span>
  db  <span class="token punctuation">:</span> mk1      # 〇 <span class="token constant">RDS</span>の最初のデータベース名
  user<span class="token punctuation">:</span> postgres # 〇 <span class="token constant">RDS</span>のマスターユーザー名
  pass<span class="token punctuation">:</span> password # ● <span class="token constant">RDS</span>のマスターパスワード

# ● ElastiCacheの設定。
redis<span class="token punctuation">:</span>
  # ●<span class="token punctuation">:</span> ElastiCacheのエンドポイント
  host<span class="token punctuation">:</span> redis<span class="token punctuation">.</span>xxxxxx<span class="token punctuation">.</span><span class="token number">0001.</span>apne0<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com
  port<span class="token punctuation">:</span> <span class="token number">6379</span>

# 　 <span class="token constant">ID</span>タイプの設定。
id<span class="token punctuation">:</span> <span class="token string">'aid'</span>

# 　 最初に登録したユーザーを自動的にadmin（管理者）とするかどうか。
# 　 するなら <span class="token boolean">true</span> <span class="token punctuation">,</span> しないなら <span class="token boolean">false</span> 。
autoAdmin<span class="token punctuation">:</span> <span class="token boolean">true</span>
</code></pre><p>指定できたら保存する。</p><h3 id="Misskey%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89" class="blogstyle">Misskeyのビルド</h3><p>t2.microではMisskeyはビルドできないため、<strong>ローカルで</strong>ビルドしたものを転送しよう。<br>Node.jsなので、Windowsでビルドしたものを適用できる。</p><ol><li>サーバーと同じバージョンのNode.jsをインストール</li><li>Git clone（<code class="language-javascript">git clone <span class="token operator">-</span>b master git<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>syuilo<span class="token operator">/</span>misskey<span class="token punctuation">.</span>git</code>）、もしくはGitHubからMisskeyのソースをダウンロードする</li><li>サーバーと同様の<code class="language-javascript"><span class="token punctuation">.</span>config<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>yml</code>を作成</li><li><code class="language-javascript">npx yarn install</code></li><li><code class="language-javascript"><span class="token constant">NODE_ENV</span><span class="token operator">=</span>production npx yarn build</code></li><li>sftpでコピーする。</li></ol><p>builtディレクトリを準備</p><pre class="language-javascript"><code class="language-bash"># <span class="token constant">SSH</span>
exit
mkdir built</code></pre><p>sftpで転送</p><pre class="language-javascript"><code class="language-bash"># ローカル
sftp <span class="token operator">-</span>i <span class="token operator">%</span><span class="token constant">USERPROFILE</span><span class="token operator">%</span>\<span class="token punctuation">.</span>ssh\key<span class="token punctuation">.</span>pem ec2<span class="token operator">-</span>user@ec2<span class="token operator">-</span><span class="token number">13</span><span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token operator">-</span>xxx<span class="token punctuation">.</span>ap<span class="token operator">-</span>northeast<span class="token operator">-</span><span class="token number">1.</span>compute<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>com<span class="token punctuation">:</span>built
sftp<span class="token operator">></span> put <span class="token operator">-</span>rf path<span class="token operator">/</span>to<span class="token operator">/</span>built
sftp<span class="token operator">></span> bye</code></pre><p>サーバー内でコピー（爆速で終わりますが、きちんとできています）</p><ins class="adsbygoogle my-4" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><pre class="language-javascript"><code class="language-bash"># <span class="token constant">SSH</span>
sudo cp <span class="token operator">-</span>rf built <span class="token operator">/</span>home<span class="token operator">/</span>misskey<span class="token operator">/</span>misskey<span class="token operator">/</span></code></pre><h2 id="%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96" class="blogstyle">データベースの初期化</h2><pre class="language-javascript"><code class="language-bash">npx yarn run init</code></pre><h2 id="Misskey%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B" class="blogstyle">Misskeyを起動する</h2><pre class="language-javascript"><code class="language-bash"><span class="token constant">NODE_ENV</span><span class="token operator">=</span>production yarn start</code></pre><p><strong>Now listening on port 3000 on <a href="http://example.tld" target="_blank" rel="noopener">http://example.tld</a></strong> と表示されたら、設定したURLにアクセスする。</p><p>Misskeyのウェルカムページが表示されるはずだ。</p><p>アカウントの作成、ノートの作成やファイルのアップロードといった一通りの操作が正しく行えるか確認しよう。</p><h2 id="S3%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B" class="blogstyle">S3を設定する</h2><p><code class="language-javascript">管理画面<span class="token operator">/</span>インスタンスの設定</code>（/admin/instance）のドライブの設定で、[オブジェクトストレージ]のトグルをオンにする。</p><p>以下の設定を行う。</p><table class="table table-sm table-bordered"><thead><tr><th align="left">説明</th><th align="left">値</th></tr></thead><tbody><tr><td align="left">URL</td><td align="left">xxxxxxxxxx.cloudfront.net</td></tr><tr><td align="left">バケット名</td><td align="left">example.tld</td></tr><tr><td align="left">プレフィックス</td><td align="left">m</td></tr><tr><td align="left">エンドポイント</td><td align="left">s3.ap-northeast-1.amazonaws.com</td></tr><tr><td align="left">リージョン</td><td align="left">ap-northeast-1</td></tr><tr><td align="left">ポート</td><td align="left">（空白）</td></tr><tr><td align="left">アクセスキー</td><td align="left">（ユーザー作成時にメモしたキー）</td></tr><tr><td align="left">シークレットキー</td><td align="left">（ユーザー作時時にメモしたキー）</td></tr></tbody></table><h2 id="Misskey%E3%81%AE%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90" class="blogstyle">Misskeyのデーモンを作成</h2><p>いったん<kbd>Ctrl+C</kbd>でプロセスをキルし、Misskeyをデーモンで起動する設定をしよう。</p><pre class="language-javascript"><code class="language-bash">exit
sudo nano <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>misskey<span class="token punctuation">.</span>service</code></pre><p>次の内容を貼り付け、保存する。</p><pre class="language-javascript"><code class="language-ini"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>Misskey daemon

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Type<span class="token operator">=</span>simple
User<span class="token operator">=</span>misskey
ExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>npm start
WorkingDirectory<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>misskey<span class="token operator">/</span>misskey
Environment<span class="token operator">=</span><span class="token string">"NODE_ENV=production"</span>
TimeoutSec<span class="token operator">=</span><span class="token number">60</span>
StandardOutput<span class="token operator">=</span>syslog
StandardError<span class="token operator">=</span>syslog
SyslogIdentifier<span class="token operator">=</span>misskey
Restart<span class="token operator">=</span>always

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target</code></pre><p>systemdを設定し、misskeyデーモンを開始。</p><pre class="language-javascript"><code class="language-bash">sudo systemctl daemon<span class="token operator">-</span>reload
sudo systemctl enable misskey
sudo systemctl start misskey</code></pre><p>systemctlでデーモンの状態を確認。</p><pre class="language-javascript"><code class="language-bash">systemctl status misskey</code></pre><p>activeならOK。</p><p><strong>これでMisskeyのインストールはおおよそ完了だ。</strong></p><h2 id="%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E7%A8%AE%E3%80%85%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">インスタンスの種々の設定</h2><p>その他様々なインスタンスの設定があるが、管理画面のインスタンスタブ（<code class="language-javascript"><span class="token operator">/</span>admin<span class="token operator">/</span>instance</code>）にて設定できる内容とその方法を確認できる。</p><p>また、このサイトにもいくつかの記事があるので参考にしてほしい。<br><a href="./#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E5%80%8B%E5%88%A5%E8%A8%98%E4%BA%8B">→ <strong>開発者・運営者向け情報#その他の個別記事</strong></a></p></section><footer class="w-100"><div class="d-flex flex-wrap my-2 bg-light"><a class="p-3 flex-fill" href="/en/wiki/developers/email" id="next"><div class="container">Next: メールサーバーを設定する</div></a></div></footer></article><div class="small text-right mt-3"><a href="https://github.com/joinmisskey/joinmisskey.github.io/edit/pages/en/wiki/developers/installation/aws.md" target="_blank" rel="noopener"><i class="fa fas pencil-alt" data-fa-prefix="fas" data-fa-icon-name="pencil-alt" data-fa-option="{'classes':['fa-fw']}"></i>このページを編集</a></div></div></div><div class="py-3 col-12 px-0 w-100 order-2 text-center"><ins class="adsbygoogle container p-0" style="display:block;" data-ad-client="ca-pub-1736621122676736" data-ad-slot="4446014841" data-ad-format="auto" data-full-width-responsive="false"></ins></div></div><div class="bg-white mt-2" id="footer"><div class="py-3" id="footer_wrap"><div class="container"><div class="d-flex justify-content-between flex-wrap small"><div>© 2018-2019 Misskey</div><!--.
.
.
--><div class="text-muted" id="updateTime">Updated at Dec 17, 2019 11:55 PM JST</div><!--.
.
.
--><div><a href="https://github.com/syuilo/misskey" target="_blank" rel="noopener"><i class="fa fab github" data-fa-prefix="fab" data-fa-icon-name="github" data-fa-option="{'classes':['fa-fw']}"></i><span class="sr-only">GitHub</span>Misskey</a> <a href="https://github.com/joinmisskey/joinmisskey.github.io" target="_blank" rel="noopener"><i class="fa fab github" data-fa-prefix="fab" data-fa-icon-name="github" data-fa-option="{'classes':['fa-fw']}"></i><span class="sr-only">GitHub</span>joinmisskey</a> <a href="https://misskey.io/@joinmisskey" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" class="svg-inline--fa fa-w-16 fa-fw" aria-hidden="true" focusable="false" role="img" viewBox="0 0 135.47 110.81"><path d="M16.52946062 7.94270106c-1.9778846 0-3.86179086.3297709-5.65113668.98907459-3.20219613 1.13020088-5.83951672 3.1553657-7.9114326 6.07499178C.98900671 17.83220348.00017024 20.9873046.00017024 24.4720708v61.87966885c0 4.52085643 1.60096578 8.42921315 4.80316191 11.7255993 3.29638616 3.20219614 7.20527203 4.80369107 11.72612846 4.80369107 4.61504645 0 8.52340317-1.60149493 11.7255993-4.80369107 3.29638616-3.29638615 4.94471153-7.20474287 4.94471153-11.7255993V75.09894251c.03556202-2.43708742 2.54590864-1.79762713 3.81469585 0 2.37620785 4.11525727 7.41402463 7.64949968 13.27947006 7.6293917 5.86544544-.02021381 10.73713324-2.92015523 13.27999923-7.6293917.96301359-1.13573057 3.6773795-3.0709651 3.9557163 0v11.25279714c0 4.52085643 1.60096578 8.42921315 4.80316192 11.7255993 3.29638615 3.20219614 7.20527202 4.80369107 11.72612845 4.80369107 4.61504645 0 8.52340317-1.60149493 11.7255993-4.80369107 3.29638616-3.29638615 4.94471153-7.20474287 4.94471153-11.7255993V24.4720708c0-3.4847662-1.03571983-6.63986732-3.10774154-9.46530337-1.97788461-2.91962608-4.56821602-4.94471153-7.77041215-6.07499178-1.8836946-.65930369-3.76760084-.9890746-5.65113669-.9890746-5.08599655 0-9.37111335 1.9781492-12.85587955 5.93397133L54.56926475 33.50814813c-.37673363.2825436-1.6247514 2.4426965-4.27559197 2.4426965-2.6508141 0-3.75728227-2.1601529-4.13404235-2.4426965L29.24352598 13.87667238c-3.39057617-3.9557163-7.62886254-5.93397132-12.7148591-5.93397132zm104.52446544 0c-3.9557163-2.7e-7-7.34629248 1.41290323-10.17172853 4.23855094-2.73124603 2.73124603-4.09673676 6.07499178-4.09673676 10.03070808s1.36549073 7.34629248 4.09673676 10.17172853c2.82543605 2.73124603 6.21601223 4.09726592 10.17172853 4.09726592 3.9557163 0 7.34629248-1.36601989 10.17172853-4.09726592 2.82543605-2.82543605 4.23855095-6.21601223 4.23855095-10.17172853s-1.41290323-7.29946205-4.23855095-10.03070808c-2.82543605-2.82543605-6.21601223-4.23855094-10.17172853-4.23855094zm.14107337 31.36316036c-3.9557163 0-7.34629248 1.41290323-10.17172853 4.23855094-2.82543605 2.82543606-4.23802179 6.21601223-4.23802179 10.17172854v34.89528615c0 3.9557163 1.41237407 7.34629248 4.23802179 10.17172853 2.82543605 2.73124603 6.21601223 4.09726591 10.17172853 4.09726591s7.29946205-1.36599342 10.03070808-4.09726591c2.82543605-2.82543605 4.23855094-6.21601223 4.23855094-10.17172853V53.7161409c0-3.9557163-1.41290323-7.34629248-4.23855094-10.17172854-2.73124603-2.82543605-6.07499178-4.23855094-10.03070808-4.23855094z" aria-label="Mi" fill="currentColor"/></svg><span class="sr-only">Misskey</span></a> <a href="/feed.rss" target="_blank" rel="noopener"><i class="fa fas rss" data-fa-prefix="fas" data-fa-icon-name="rss" data-fa-option="{'classes':['fa-fw']}"></i><span>RSS</span></a> <a href="/feed.json" target="_blank" rel="noopener"><i class="fa fas rss" data-fa-prefix="fas" data-fa-icon-name="rss" data-fa-option="{'classes':['fa-fw']}"></i><span>JSON</span></a> <a href="/feed.atom" target="_blank" rel="noopener"><i class="fa fas rss" data-fa-prefix="fas" data-fa-icon-name="rss" data-fa-option="{'classes':['fa-fw']}"></i><span>Atom</span></a></div></div></div></div></div></body></html>